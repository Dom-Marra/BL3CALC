<div class="skill-tree-container">

    <svg xmlns="http://www.w3.org/2000/svg" height="0" width="0">
        <filter id="highlight">
            <feGaussianBlur stdDeviation="3" result="blurred" />
            <feFlood flood-color="yellow" result="glowColor" />
            <feComposite in="glowColor" in2="blurred" operator="in" result="glow" />
            <feMerge>
                <feMergeNode in="glow"/>
                <feMergeNode in="SourceGraphic"/>
            </feMerge>
            <feColorMatrix type="matrix"
            color-interpolation-filters="sRGB"
            result="highlight"
            values="1 0 0 0 0
                    0 1 0 0 0
                    0 0 0 0 0
                    0 0 0 1 0" />
        </filter>
        <filter id="activated-blue">
            <feColorMatrix type="matrix"
            color-interpolation-filters="sRGB"
            values="0 0 0 0 0
                    0 1 0 0 0
                    0 0 1 0 0
                    0 0 0 1 0" />
            <feComponentTransfer>
                <feFuncR type="linear" slope="1"/>
                <feFuncG type="linear" slope="1"/>
                <feFuncB type="linear" slope="1"/>
            </feComponentTransfer>
        </filter>
        <filter id="activated-red">
            <feColorMatrix type="matrix"
            color-interpolation-filters="sRGB"
            values="0.99 0 0 0 0
                    0 0.58 0 0 0
                    0 0 0.17 0 0
                    0 0 0 1 0" />
            <feComponentTransfer>
                <feFuncR type="linear" slope="2"/>
                <feFuncG type="linear" slope="2"/>
                <feFuncB type="linear" slope="2"/>
            </feComponentTransfer>
        </filter>
        <filter id="activated-green">
            <feColorMatrix type="matrix"
            color-interpolation-filters="sRGB"
            values="0.42 0 0 0 0
                    0 0.77 0 0 0
                    0 0 0.06 0 0
                    0 0 0 1 0" />
            <feComponentTransfer>
                <feFuncR type="linear" slope="1.5"/>
                <feFuncG type="linear" slope="1.5"/>
                <feFuncB type="linear" slope="1.5"/>
            </feComponentTransfer>
        </filter>
        <filter id="skill-disabled">
            <feComponentTransfer>
                <feFuncR type="linear" slope="0.5"/>
                <feFuncG type="linear" slope="0.5"/>
                <feFuncB type="linear" slope="0.5"/>
            </feComponentTransfer>
        </filter>
    </svg>

    <!--Original Viewbox (300, 696)-->
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 438 900" class="tree">
        <linearGradient *ngIf="color == 'blue'" id="blue-fill" x1="0" x2="0" y1="0" y2="1">
            <stop attr.offset="{{mainOff}}" stop-color="rgb(34, 92, 137)"/>
            <stop attr.offset="{{secondOff}}" stop-color="rgb(132, 164, 189)"/>
            <stop offset="0%" stop-color="rgb(9, 22, 35)"/>
        </linearGradient>
        <linearGradient *ngIf="color == 'green'" id="green-fill" x1="0" x2="0" y1="0" y2="1">
            <stop attr.offset="{{mainOff}}" stop-color="rgb(61, 97, 28)"/>
            <stop attr.offset="{{secondOff}}" stop-color="rgb(145, 166, 127)"/>
            <stop offset="0%" stop-color="rgb(24, 38, 10)"/>
        </linearGradient>
        <linearGradient *ngIf="color == 'red'" id="red-fill" x1="0" x2="0" y1="0" y2="1">
            <stop attr.offset="{{mainOff}}" stop-color="rgb(88, 47, 27)"/>
            <stop attr.offset="{{secondOff}}" stop-color="rgb(161, 138, 126)"/>
            <stop offset="0%" stop-color="rgb(36, 16, 5)"/>
        </linearGradient>
        

        
        <g transform="translate(69, 102)">
            <polygon  points="2,18 17,2 52,2 67,18
                            232,18 248,2 283,2 298,18 
                            298,674 280,694 
                            20,694 2,674" class="top-border"></polygon>
            <polygon points="2,18 17,2 52,2 67,18
                            232,18 248,2 283,2 298,18 
                            298,674 280,694 
                            20,694 2,674" class="middle-border"></polygon>
            <polygon points="2,18 17,2 52,2 67,18
                            232,18 248,2 283,2 298,18 
                            298,674 280,694 
                            20,694 2,674" class="main-back"></polygon>
            <polygon points="12,56 17,50 42,50 50,58 
                            250,58 258,50 283,50 288,56 
                            288,630 273,645 
                            27, 645, 12,630" class="main-front"></polygon>
            <image width="300" x="0" y="-65"attr.href="{{header}}" ></image>
            <text class="tree-name doNotSelect" x="150" y="680" text-anchor="middle">{{treeName}}</text>
        </g>
        
       
        
        <g [class.activated]="skill.getAllocatedPoints() > skill.MIN_POINTS"
           [class.disabled]="allocatedPoints < skill.getPreReq()" 
            class="skill doNotSelect" 
            *ngFor="let skill of skills.slice().reverse()" 
            (click)="((isActionMod(skill) && this.character.getMaxActionModPoints() == 1 && this.character.getMaxActionSkillPoints() == 1) 
                    || (isActionSkill(skill) && this.character.getMaxActionSkillPoints() == 1)) ||
                    !(isActionMod(skill) || isActionSkill(skill)) ? addPoint(skill) : ''" 
            (contextmenu)="removePoint(skill)"
            oncontextmenu="return false;" 
            transform=" translate(27 51)"
            (mouseenter)="showToolTip(skill, $event)"
            (mouseleave)="showToolTip(null, null)">

            <g class="special-skill" *ngIf="skill.getPosition()[1] == -1" attr.transform="translate(44, {{120 + skill.getPosition()[0] * 98}})">
                <polygon
                    class="special-skill-border"
                    points="-67,12 -55,0 3,0 2,81 -55,81 -67,69"
                />
                <polygon
                    class="special-skill-mid-border"
                    points="-67,12 -55,0 3,0 2,81 -55,81 -67,69"
                />
                <polygon
                    class="special-skill-main"
                    points="-67,12 -55,0 3,0 2,81 -55,81 -67,69"
                />
            </g>
            
            <g class="special-skill" *ngIf="skill.getPosition()[1] == 3" attr.transform="translate(38, {{120 + skill.getPosition()[0] * 98}})">
                <polygon
                    class="special-skill-border"
                    points="370,12 358,0 300,0 300,81 358,81 370,69"
                />
                <polygon
                    class="special-skill-mid-border"
                    points="370,12 358,0 300,0 300,81 358,81 370,69"
                />
                <polygon
                    class="special-skill-main"
                    points="370,12 358,0 300,0 300,81 358,81 370,69"
                />
            </g>

            
            <image width="70" 
                    attr.x="{{skill.getPosition()[1] < 0 ? 
                        -10 :
                        (skill.getPosition()[1] < 3 ? 
                        69 + (skill.getPosition()[1] * 88)   :
                        324)}}" 
                    attr.y="{{127 + (skill.getPosition()[0] * 98)}}" 
                    attr.href="{{skill.getSkillBoxPath()}}" />

            <image width="50"
                    attr.x="{{skill.getPosition()[1] < 0 ? 
                            0:
                            (skill.getPosition()[1] < 3 ? 
                            79 + (skill.getPosition()[1] * 88) :
                            333)}}"
                    attr.y="{{135 + (skill.getPosition()[0] * 98)}}"
                    attr.href="{{skill.getPath()}}" />

            <g *ngIf="(isActionMod(skill) 
                      && ((this.character.getMaxActionModPoints() > 1
                      && (this.character.getEquippedSkills()[0].actionSkill == skill.getRequiredActionSkill() 
                          || (this.character.getEquippedSkills()[1].actionSkill == skill.getRequiredActionSkill())
                             && (this.character.getMaxActionModPoints() > 2 || this.character.getMaxActionSkillPoints() == 1))
                      && ((this.character.getMaxActionSkillPoints() == 1
                         &&  skill != this.character.getEquippedSkills()[0].actionMods[0]) 
                      || (this.character.getMaxActionSkillPoints() > 1
                        && skill != this.character.getEquippedSkills()[0].actionMods[0]
                        && skill != this.character.getEquippedSkills()[1].actionMods[0])))
                      

                      || this.character.getMaxActionSkillPoints() > 1
                      && this.character.getEquippedSkills()[0].actionSkill == skill.getRequiredActionSkill()
                      && skill != this.character.getEquippedSkills()[0].actionMods[0]
                      && skill != this.character.getEquippedSkills()[0].actionMods[1])) 

                      || (isActionSkill(skill) 
                          && this.character.getMaxActionSkillPoints() > 1
                          && this.character.getEquippedSkills()[0].actionSkill != skill)" 
                class="left-right-select"
                (click)="addPoint(skill,0)">
                <rect attr.x="{{skill.getPosition()[1] == -1 ? -33 :
                                skill.getPosition()[1] == 3 ? 300 : 
                                133}}" 
                      attr.y="{{110 + (skill.getPosition()[0] * 98)}}"
                      height="25" width="60" rx="5" ry="5" />
                <text attr.x="{{skill.getPosition()[1] == -1 ? -25 :
                                skill.getPosition()[1] == 3 ? 308 : 
                                141}}" 
                        attr.y="{{127 + (skill.getPosition()[0] * 98)}}">+Slot 1</text>
            </g>
            <g *ngIf="(isActionMod(skill) 
                      && ((this.character.getMaxActionModPoints() > 1 
                      && ((this.character.getEquippedSkills()[0].actionSkill == skill.getRequiredActionSkill() 
                          && (this.character.getMaxActionModPoints() > 2 || this.character.getMaxActionSkillPoints() == 1))
                          || this.character.getEquippedSkills()[1].actionSkill == skill.getRequiredActionSkill())
                      && ((this.character.getMaxActionSkillPoints() == 1
                          &&  skill != this.character.getEquippedSkills()[0].actionMods[1]) 
                      || (this.character.getMaxActionSkillPoints() > 1
                          && skill != this.character.getEquippedSkills()[0].actionMods[1]
                          && skill != this.character.getEquippedSkills()[1].actionMods[1]
                          && ((this.character.getMaxActionModPoints() == 2
                                && skill != this.character.getEquippedSkills()[1].actionMods[0])
                                || this.character.getMaxActionModPoints() > 2))))

                      || this.character.getMaxActionSkillPoints() > 1
                      && this.character.getEquippedSkills()[1].actionSkill == skill.getRequiredActionSkill()
                      && skill != this.character.getEquippedSkills()[1].actionMods[0]
                      && skill != this.character.getEquippedSkills()[1].actionMods[1]))

                      || (isActionSkill(skill) 
                          && this.character.getMaxActionSkillPoints() > 1
                          && this.character.getEquippedSkills()[1].actionSkill != skill)"
                 class="left-right-select"
                 (click)="addPoint(skill,1)">
                <rect attr.x="{{skill.getPosition()[1] == -1 ? 27 :
                                skill.getPosition()[1] == 3 ? 360 : 
                                193}}" 
                      attr.y="{{110 + (skill.getPosition()[0] * 98)}}"
                      height="25" width="60" rx="5" ry="5" />
                <text attr.x="{{skill.getPosition()[1] == -1 ? 35 :
                                skill.getPosition()[1] == 3 ? 368 : 
                                201}}" 
                      attr.y="{{127 + (skill.getPosition()[0] * 98)}}">+Slot 2</text>
            </g>
                    
            <g *ngIf="(skill.getPosition()[1] >= 0 && skill.getPosition()[1] < 3  && skill.getPosition()[0] >= 0 )">
                <image width="35"
                        attr.x="{{115 + (skill.getPosition()[1] * 88)}}" 
                        attr.y="{{178 + (skill.getPosition()[0] * 98)}}" 
                        href="assets/images/skilltree/pointBox.webp" />
                <text class="points" 
                        attr.x="{{132 + (skill.getPosition()[1] * 88)}}"
                        attr.y="{{195 + (skill.getPosition()[0] * 98)}}"
                        text-anchor="middle"
                        >{{skill.allocatedPoints}}/{{skill.maxPoints}}</text>
            </g>
        </g>
        <g class="tree-reset">
            <rect height="40" width="300" x="69" y="810" rx="5" ry="5" (click)="reset()"/>
            <text x="50%" y="835" text-anchor="middle">Reset</text>
        </g>
    </svg>
</div>
